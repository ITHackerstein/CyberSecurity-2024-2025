import requests, sys, colorama
from http.client import responses

colorama.init(autoreset=True)

protected_page = sys.argv[1] if len(sys.argv) > 1 else "http://localhost:3000/dashboard"

print(f"[{colorama.Fore.CYAN}INFO{colorama.Fore.RESET}] Attempting to access '{protected_page}'...")
response = requests.get(protected_page, allow_redirects=False)
print(f"[{colorama.Fore.CYAN}INFO{colorama.Fore.RESET}] Status code: {response.status_code} {responses[response.status_code]}")
assert response.status_code == 307

print(f"[{colorama.Fore.RED}ERROR{colorama.Fore.RESET}] Couldn't access protected page")

print()

print(f"[{colorama.Fore.CYAN}INFO{colorama.Fore.RESET}] Attempting to access '{protected_page}' using custom headers...")
response = requests.get(protected_page, headers={
    'X-Middleware-Subrequest': 'middleware'
}, allow_redirects=False)
print(f"[{colorama.Fore.CYAN}INFO{colorama.Fore.RESET}] Status code: {response.status_code} {responses[response.status_code]}")
assert response.status_code == 200
print(f"[{colorama.Fore.GREEN}SUCCESS{colorama.Fore.RESET}] Protected page accessed")
